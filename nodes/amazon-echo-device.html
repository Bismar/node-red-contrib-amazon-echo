<!-- amazon-echo-device.html -->
<!-- Editor UI + Help + Node registration for the "amazon-echo-device" node -->

<!-- =========================
     EDITOR TEMPLATE
========================= -->
<script type="text/x-red" data-template-name="amazon-echo-device">
  <div class="amazon-echo-device-config">

    <div class="form-row">
      <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Friendly device name (used by Alexa)">
    </div>

    <div class="form-row">
      <label for="node-input-server"><i class="fa fa-home"></i> Home Assistant Server</label>
      <input type="text" id="node-input-server">
    </div>

    <div class="form-row">
      <label for="node-input-component" class="nowrap"><i class="fa fa-cubes"></i> Component&nbsp;Type</label>
      <select id="node-input-component">
        <option value="switch">switch</option>
        <option value="light">light</option>
        <option value="fan">fan</option>
        <option value="cover">cover</option>
        <option value="climate">climate</option>
        <option value="scene">scene</option>
        <option value="script">script</option>
        <option value="input_boolean">input_boolean</option>
      </select>
    </div>

    <div class="form-row">
      <label for="node-input-entity_id"><i class="fa fa-hashtag"></i> Entity ID</label>
      <input type="text" id="node-input-entity_id" placeholder="e.g. light.living_room">
    </div>

    <div class="form-row">
      <label for="node-input-room"><i class="fa fa-map-marker"></i> Room (optional)</label>
      <input type="text" id="node-input-room" placeholder="For your own reference">
    </div>

    <div class="form-row">
      <label for="node-input-passThrough"><i class="fa fa-random"></i> Pass through</label>
      <input type="checkbox" id="node-input-passThrough" style="width:auto">
      <span class="form-tips">When enabled, incoming messages will be forwarded after processing.</span>
    </div>

    <div class="form-row">
      <label for="node-input-debug"><i class="fa fa-bug"></i> Debug</label>
      <input type="checkbox" id="node-input-debug" style="width:auto">
      <span class="form-tips">Outputs diagnostic info on state changes.</span>
    </div>

  </div>
</script>

<!-- =========================
     HELP TEXT
========================= -->
<script type="text/markdown" data-help-name="amazon-echo-device">
Create a virtual device that Alexa can discover and control via the **Amazon Echo Hub** node.

**Fields**
- **Name** – Friendly name Alexa uses (must be unique).
- **Home Assistant Server** – Your configured HA server reference.
- **Component Type** – The HA domain to control (e.g. `light`, `switch`, `fan`, `cover`, `climate`).
- **Entity ID** – The Home Assistant entity id (e.g. `light.living_room`).
- **Pass through** – Forward input messages after device processing.
- **Debug** – Output additional diagnostic messages.

After adding/updating devices:
1. Deploy your flow.
2. Ask **“Alexa, discover devices.”**
</script>

<!-- =========================
     NODE REGISTRATION (Editor)
========================= -->
<script type="text/javascript">
  (function() {
    RED.nodes.registerType('amazon-echo-device', {
      category: 'home_assistant',
      color: '#13b1ff',
      icon: 'bridge.svg',
      paletteLabel: 'amazon echo device',
      defaults: {
        name: { value: "" },
        server: { value: "", type: "ha-server", required: true },
        component: { value: "switch", required: true },
        entity_id: { value: "", required: true },
        room: { value: "" },
        passThrough: { value: false },
        debug: { value: false }
      },
      inputs: 1,
      outputs: 1,
      align: 'right',
      label: function() {
        return this.name || this.entity_id || "amazon-echo-device";
      },
      oneditprepare: function () {
        // If the original used typedInput for server, re-init here.
        // Keeping neutral to work with either plain input or typed config reference.
        try {
          if ($("#node-input-server").length && !$("#node-input-server").hasClass("red-ui-typedInput")) {
            // no-op; server is declared as a config node via defaults.type above
          }
        } catch (e) {}
      }
    });
  })();
</script>

<!-- =========================
     LAYOUT / FIXES
========================= -->
<style>
  /* Keep “Component Type” label on one line */
  .amazon-echo-device-config .form-row label.nowrap {
    white-space: nowrap;
  }

  /* Ensure consistent label widths & input alignment across rows */
  .amazon-echo-device-config .form-row > label {
    width: 160px;                  /* Slightly wider to accommodate long labels */
    display: inline-block;
    box-sizing: border-box;
    vertical-align: top;
    margin-right: 10px;
  }

  /* Inputs/selects/typedInputs align to form grid */
  .amazon-echo-device-config .form-row > input[type="text"],
  .amazon-echo-device-config .form-row > select,
  .amazon-echo-device-config .form-row > .red-ui-typedInput,
  .amazon-echo-device-config .form-row > .input-append {
    width: calc(100% - 170px);     /* 160 label + 10 gap */
    max-width: 100%;
    box-sizing: border-box;
  }

  /* Normalize specific rows that sometimes had inline widths */
  .amazon-echo-device-config #node-input-name,
  .amazon-echo-device-config #node-input-server,
  .amazon-echo-device-config #node-input-component {
    width: calc(100% - 170px) !important;
  }

  /* Small helper text style */
  .amazon-echo-device-config .form-tips {
    margin-left: 8px;
    font-size: 0.9em;
    color: var(--red-ui-secondary-text, #666);
  }
</style>
